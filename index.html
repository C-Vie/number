<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>20ä»¥å†…è¿›ä½é€€ä½åŠ å‡æ³•ç»ƒä¹ </title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <!-- ç»Ÿä¸€çš„ Tailwind é…ç½® -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5', // é›è“è‰²ä½œä¸ºä¸»è‰²è°ƒï¼Œä»£è¡¨æ™ºæ…§å’Œä¸“æ³¨
                        secondary: '#10B981', // ç»¿è‰²ä½œä¸ºè¾…åŠ©è‰²ï¼Œä»£è¡¨è¿›æ­¥å’Œæˆé•¿
                        accent: '#F59E0B', // æ©™è‰²ä½œä¸ºå¼ºè°ƒè‰²ï¼Œå¢åŠ æ´»åŠ›
                        neutral: '#F3F4F6', // æµ…ç°è‰²ä½œä¸ºä¸­æ€§è‰²
                        'neutral-dark': '#9CA3AF', // æ·±ç°è‰²ç”¨äºæ–‡æœ¬
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'bounce-short': 'bounce 0.5s ease-in-out 2',
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .glass-effect {
                background: rgba(255, 255, 255, 0.7);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
            }
            .card-shadow {
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            }
            .btn-hover {
                transition: all 0.3s ease;
            }
            .btn-hover:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
            }
            .btn-correct {
                background-color: #10B981;
                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            }
            .btn-incorrect {
                background-color: #EF4444;
                box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
            }
            .input-focus {
                transition: all 0.3s ease;
            }
            .input-focus:focus {
                border-color: #4F46E5;
                box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- é¡¶éƒ¨ä¿¡æ¯å¡ç‰‡ -->
        <div class="bg-white rounded-xl p-6 mb-6 card-shadow glass-effect animate-fade-in">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-primary mb-2">20ä»¥å†…è¿›ä½é€€ä½åŠ å‡æ³•ç»ƒä¹ </h1>
                    <p class="text-neutral-dark" id="current-date">2023å¹´7æœˆ21æ—¥ æ˜ŸæœŸä¸€</p>
                </div>
                <div class="mt-4 md:mt-0 flex items-center">
                    <div class="bg-neutral rounded-full px-4 py-2 mr-4">
                        <span class="text-sm text-neutral-dark">ä»Šæ—¥è¿›åº¦</span>
                        <div class="flex items-center mt-1">
                            <span id="progress-text" class="text-lg font-bold text-primary">0/30</span>
                            <div class="w-32 h-2 bg-gray-200 rounded-full ml-3">
                                <div id="progress-bar" class="h-2 bg-secondary rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <button id="show-stats-btn" class="bg-accent hover:bg-amber-500 text-white rounded-full px-4 py-2 flex items-center btn-hover">
                        <i class="fa fa-bar-chart mr-2"></i>
                        <span>æŸ¥çœ‹ç»Ÿè®¡</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- é¢˜ç›®å¡ç‰‡ -->
        <div id="question-card" class="bg-white rounded-xl p-6 mb-6 card-shadow glass-effect animate-fade-in">
            <div class="flex flex-col items-center">
                <div class="text-4xl md:text-5xl font-bold mb-8 text-center" id="question-text">
                    8 + 7 = ?
                </div>
                <div class="flex items-center w-full max-w-md">
                    <input type="number" id="answer-input" class="w-full text-2xl border-2 border-gray-300 rounded-lg px-4 py-3 input-focus text-center" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ" autofocus>
                    <button id="submit-btn" class="bg-primary hover:bg-indigo-600 text-white rounded-lg px-6 py-3 ml-3 btn-hover text-lg font-medium">
                        æäº¤
                    </button>
                </div>
                <div id="feedback-message" class="mt-4 text-lg font-medium hidden"></div>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="flex flex-wrap justify-center gap-4 mb-6">
            <button id="skip-btn" class="bg-neutral hover:bg-gray-200 text-neutral-dark rounded-lg px-6 py-3 btn-hover">
                <i class="fa fa-forward mr-2"></i>
                è·³è¿‡æ­¤é¢˜
            </button>
            <button id="show-wrong-btn" class="bg-neutral hover:bg-gray-200 text-neutral-dark rounded-lg px-6 py-3 btn-hover">
                <i class="fa fa-exclamation-triangle mr-2"></i>
                é”™é¢˜å›é¡¾
            </button>
            <button id="reset-day-btn" class="bg-red-500 hover:bg-red-600 text-white rounded-lg px-6 py-3 btn-hover">
                <i class="fa fa-refresh mr-2"></i>
                é‡æ–°å¼€å§‹
            </button>
        </div>

        <!-- é”™é¢˜å±•ç¤ºåŒºåŸŸ -->
        <div id="wrong-questions-section" class="bg-white rounded-xl p-6 mb-6 card-shadow glass-effect hidden animate-fade-in">
            <h2 class="text-xl font-bold text-primary mb-4">é”™é¢˜å›é¡¾</h2>
            <div id="wrong-questions-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- é”™é¢˜å°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
    </div>

    <!-- ç»Ÿè®¡å›¾è¡¨æ¨¡æ€æ¡† -->
    <div id="stats-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-3xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-primary">å­¦ä¹ ç»Ÿè®¡</h2>
                <button id="close-stats-btn" class="text-neutral-dark hover:text-gray-700 text-2xl">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3">æœ€è¿‘7å¤©æ­£ç¡®ç‡</h3>
                <div class="bg-neutral rounded-lg p-4">
                    <canvas id="accuracy-chart" height="200"></canvas>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-neutral rounded-lg p-4 text-center">
                    <h4 class="text-neutral-dark mb-2">æ€»ç»ƒä¹ å¤©æ•°</h4>
                    <p id="total-days" class="text-3xl font-bold text-primary">0</p>
                </div>
                <div class="bg-neutral rounded-lg p-4 text-center">
                    <h4 class="text-neutral-dark mb-2">æœ€ä½³æ­£ç¡®ç‡</h4>
                    <p id="best-accuracy" class="text-3xl font-bold text-secondary">0%</p>
                </div>
                <div class="bg-neutral rounded-lg p-4 text-center">
                    <h4 class="text-neutral-dark mb-2">æ€»ç­”é¢˜æ•°</h4>
                    <p id="total-questions" class="text-3xl font-bold text-accent">0</p>
                </div>
            </div>
        </div>
    </div>

    <!-- åé¦ˆæç¤º -->
    <div id="toast" class="fixed bottom-6 right-6 bg-white rounded-lg shadow-lg px-6 py-3 transform translate-y-20 opacity-0 transition-all duration-300 flex items-center">
        <i id="toast-icon" class="fa fa-check-circle text-secondary mr-3 text-xl"></i>
        <span id="toast-message">æ“ä½œæˆåŠŸ</span>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentQuestions = []; // å½“å‰é¢˜ç›®åˆ—è¡¨
        let currentQuestionIndex = 0; // å½“å‰é¢˜ç›®ç´¢å¼•
        let userAnswers = []; // ç”¨æˆ·ç­”æ¡ˆ
        let wrongQuestions = []; // é”™é¢˜è®°å½•
        let todayStats = { correct: 0, total: 0 }; // ä»Šæ—¥ç»Ÿè®¡
        let historyStats = []; // å†å²ç»Ÿè®¡æ•°æ®
        let currentDate = new Date(); // å½“å‰æ—¥æœŸ
        let todayDateStr = formatDate(currentDate); // æ ¼å¼åŒ–çš„ä»Šæ—¥æ—¥æœŸå­—ç¬¦ä¸²

        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            // è®¾ç½®å½“å‰æ—¥æœŸ
            document.getElementById('current-date').textContent = formatDateWithWeekday(currentDate);
            
            // åŠ è½½æœ¬åœ°å­˜å‚¨çš„æ•°æ®
            loadData();
            
            // æ£€æŸ¥æ˜¯å¦éœ€è¦ç”Ÿæˆæ–°é¢˜ç›®
            checkAndGenerateQuestions();
            
            // æ›´æ–°UI
            updateUI();
            
            // ç»‘å®šäº‹ä»¶
            bindEvents();
        }

        // æ ¼å¼åŒ–æ—¥æœŸä¸º YYYY-MM-DD
        function formatDate(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }

        // æ ¼å¼åŒ–æ—¥æœŸä¸ºä¸­æ–‡æ ¼å¼ï¼ŒåŒ…å«æ˜ŸæœŸ
        function formatDateWithWeekday(date) {
            const weekdays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
            return `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ ${weekdays[date.getDay()]}`;
        }

        // åŠ è½½æœ¬åœ°å­˜å‚¨çš„æ•°æ®
        function loadData() {
            // åŠ è½½ç”¨æˆ·ç­”æ¡ˆ
            const savedAnswers = localStorage.getItem(`mathPractice_answers_${todayDateStr}`);
            if (savedAnswers) {
                userAnswers = JSON.parse(savedAnswers);
            }
            
            // åŠ è½½é”™é¢˜è®°å½•
            const savedWrongQuestions = localStorage.getItem(`mathPractice_wrong_${todayDateStr}`);
            if (savedWrongQuestions) {
                wrongQuestions = JSON.parse(savedWrongQuestions);
            }
            
            // åŠ è½½ä»Šæ—¥ç»Ÿè®¡
            const savedTodayStats = localStorage.getItem(`mathPractice_stats_${todayDateStr}`);
            if (savedTodayStats) {
                todayStats = JSON.parse(savedTodayStats);
            }
            
            // åŠ è½½å†å²ç»Ÿè®¡
            const savedHistoryStats = localStorage.getItem('mathPractice_historyStats');
            if (savedHistoryStats) {
                historyStats = JSON.parse(savedHistoryStats);
            }
            
            // åŠ è½½ä¸Šæ¬¡ç»ƒä¹ æ—¥æœŸ
            const lastPracticeDate = localStorage.getItem('mathPractice_lastDate');
            
            // å¦‚æœæ˜¯æ–°çš„ä¸€å¤©ï¼Œé‡ç½®æ•°æ®
            if (lastPracticeDate !== todayDateStr) {
                // ä¿å­˜æ˜¨å¤©çš„ç»Ÿè®¡åˆ°å†å²è®°å½•
                if (lastPracticeDate) {
                    const yesterdayStats = localStorage.getItem(`mathPractice_stats_${lastPracticeDate}`);
                    if (yesterdayStats) {
                        const stats = JSON.parse(yesterdayStats);
                        // åªä¿å­˜å®Œæˆç‡è¶…è¿‡30%çš„æ—¥æœŸçš„ç»Ÿè®¡
                        if (stats.total >= 10) {
                            historyStats.push({
                                date: lastPracticeDate,
                                correct: stats.correct,
                                total: stats.total,
                                accuracy: Math.round((stats.correct / stats.total) * 100)
                            });
                            
                            // åªä¿ç•™æœ€è¿‘30å¤©çš„è®°å½•
                            if (historyStats.length > 30) {
                                historyStats.shift();
                            }
                            
                            // ä¿å­˜æ›´æ–°åçš„å†å²è®°å½•
                            localStorage.setItem('mathPractice_historyStats', JSON.stringify(historyStats));
                        }
                    }
                }
                
                // é‡ç½®ä»Šæ—¥æ•°æ®
                userAnswers = [];
                wrongQuestions = [];
                todayStats = { correct: 0, total: 0 };
                
                // æ›´æ–°æœ€åç»ƒä¹ æ—¥æœŸ
                localStorage.setItem('mathPractice_lastDate', todayDateStr);
            }
        }

        // æ£€æŸ¥æ˜¯å¦éœ€è¦ç”Ÿæˆæ–°é¢˜ç›®
        function checkAndGenerateQuestions() {
            // å°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½ä»Šæ—¥é¢˜ç›®
            const savedQuestions = localStorage.getItem(`mathPractice_questions_${todayDateStr}`);
            
            if (savedQuestions) {
                currentQuestions = JSON.parse(savedQuestions);
            } else {
                // ç”Ÿæˆæ–°é¢˜ç›®
                currentQuestions = generateQuestions();
                
                // ä¿å­˜é¢˜ç›®åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem(`mathPractice_questions_${todayDateStr}`, JSON.stringify(currentQuestions));
            }
            
            // æ‰¾åˆ°å½“å‰åº”è¯¥æ˜¾ç¤ºçš„é¢˜ç›®ç´¢å¼•
            currentQuestionIndex = userAnswers.length;
        }

        // ç”Ÿæˆ30é“20ä»¥å†…è¿›ä½é€€ä½åŠ å‡æ³•é¢˜ç›®
        function generateQuestions() {
            const questions = [];
            const operators = ['+', '-'];
            
            // ç”Ÿæˆ15é“åŠ æ³•é¢˜ï¼ˆå…¶ä¸­åŒ…å«è¿›ä½åŠ æ³•ï¼‰
            for (let i = 0; i < 15; i++) {
                let num1, num2;
                
                // ç¡®ä¿æ˜¯è¿›ä½åŠ æ³•
                if (i < 10) {
                    // ç”Ÿæˆè¿›ä½åŠ æ³•é¢˜ (ç»“æœ > 10)
                    num1 = Math.floor(Math.random() * 9) + 2; // 2-10
                    num2 = Math.floor(Math.random() * (10 - num1 + 1)) + (10 - num1); // ç¡®ä¿ num1 + num2 >= 10
                } else {
                    // ç”Ÿæˆæ™®é€šåŠ æ³•é¢˜
                    num1 = Math.floor(Math.random() * 10) + 1; // 1-10
                    num2 = Math.floor(Math.random() * 10) + 1; // 1-10
                }
                
                const answer = num1 + num2;
                questions.push({
                    id: `q${i+1}`,
                    text: `${num1} + ${num2} = ?`,
                    answer: answer,
                    type: 'addition'
                });
            }
            
            // ç”Ÿæˆ15é“å‡æ³•é¢˜ï¼ˆå…¶ä¸­åŒ…å«é€€ä½å‡æ³•ï¼‰
            for (let i = 15; i < 30; i++) {
                let num1, num2;
                
                // ç¡®ä¿æ˜¯é€€ä½å‡æ³•
                if (i < 25) {
                    // ç”Ÿæˆé€€ä½å‡æ³•é¢˜ (ä¸ªä½æ•°ä¸å¤Ÿå‡)
                    num1 = Math.floor(Math.random() * 9) + 11; // 11-19
                    const onesDigit1 = num1 % 10;
                    num2 = Math.floor(Math.random() * onesDigit1) + (10 - onesDigit1 + 1); // ç¡®ä¿æ˜¯é€€ä½å‡æ³•
                } else {
                    // ç”Ÿæˆæ™®é€šå‡æ³•é¢˜
                    num1 = Math.floor(Math.random() * 10) + 11; // 11-20
                    num2 = Math.floor(Math.random() * num1) + 1; // 1-num1
                }
                
                const answer = num1 - num2;
                questions.push({
                    id: `q${i+1}`,
                    text: `${num1} - ${num2} = ?`,
                    answer: answer,
                    type: 'subtraction'
                });
            }
            
            // éšæœºæ‰“ä¹±é¢˜ç›®é¡ºåº
            return shuffleArray(questions);
        }

        // éšæœºæ‰“ä¹±æ•°ç»„
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // æ›´æ–°UI
        function updateUI() {
            // æ›´æ–°è¿›åº¦
            document.getElementById('progress-text').textContent = `${userAnswers.length}/30`;
            document.getElementById('progress-bar').style.width = `${(userAnswers.length / 30) * 100}%`;
            
            // å¦‚æœè¿˜æœ‰æœªåšçš„é¢˜ç›®ï¼Œæ˜¾ç¤ºå½“å‰é¢˜ç›®
            if (currentQuestionIndex < currentQuestions.length) {
                document.getElementById('question-text').textContent = currentQuestions[currentQuestionIndex].text;
                document.getElementById('answer-input').value = '';
                document.getElementById('answer-input').focus();
                document.getElementById('feedback-message').classList.add('hidden');
            } else {
                // æ‰€æœ‰é¢˜ç›®éƒ½å·²å®Œæˆ
                document.getElementById('question-text').textContent = 'ğŸ‰ ä»Šæ—¥ç»ƒä¹ å®Œæˆï¼';
                document.getElementById('answer-input').classList.add('hidden');
                document.getElementById('submit-btn').classList.add('hidden');
                
                const feedbackMessage = document.getElementById('feedback-message');
                feedbackMessage.textContent = `æ­£ç¡®ç‡: ${Math.round((todayStats.correct / todayStats.total) * 100)}% (${todayStats.correct}/${todayStats.total})`;
                feedbackMessage.className = 'mt-4 text-lg font-medium text-secondary';
                feedbackMessage.classList.remove('hidden');
            }
            
            // æ›´æ–°é”™é¢˜åˆ—è¡¨
            updateWrongQuestionsList();
        }

        // æ›´æ–°é”™é¢˜åˆ—è¡¨
        function updateWrongQuestionsList() {
            const wrongQuestionsList = document.getElementById('wrong-questions-list');
            wrongQuestionsList.innerHTML = '';
            
            if (wrongQuestions.length === 0) {
                wrongQuestionsList.innerHTML = '<p class="text-neutral-dark col-span-2 text-center py-4">æš‚æ— é”™é¢˜è®°å½•</p>';
                return;
            }
            
            wrongQuestions.forEach((wrongQ, index) => {
                const question = currentQuestions.find(q => q.id === wrongQ.id);
                if (question) {
                    const wrongItem = document.createElement('div');
                    wrongItem.className = 'bg-neutral rounded-lg p-4 flex items-center justify-between';
                    wrongItem.innerHTML = `
                        <div>
                            <p class="font-medium">${question.text}</p>
                            <p class="text-sm text-red-500">ä½ çš„ç­”æ¡ˆ: ${wrongQ.userAnswer}</p>
                        </div>
                        <p class="text-lg font-bold text-secondary">æ­£ç¡®ç­”æ¡ˆ: ${question.answer}</p>
                    `;
                    wrongQuestionsList.appendChild(wrongItem);
                }
            });
        }

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // æäº¤ç­”æ¡ˆ
            document.getElementById('submit-btn').addEventListener('click', submitAnswer);
            document.getElementById('answer-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    submitAnswer();
                }
            });
            
            // è·³è¿‡é¢˜ç›®
            document.getElementById('skip-btn').addEventListener('click', skipQuestion);
            
            // æ˜¾ç¤º/éšè—é”™é¢˜
            document.getElementById('show-wrong-btn').addEventListener('click', toggleWrongQuestions);
            
            // é‡ç½®ä»Šæ—¥ç»ƒä¹ 
            document.getElementById('reset-day-btn').addEventListener('click', resetDay);
            
            // æ˜¾ç¤º/éšè—ç»Ÿè®¡æ¨¡æ€æ¡†
            document.getElementById('show-stats-btn').addEventListener('click', showStatsModal);
            document.getElementById('close-stats-btn').addEventListener('click', hideStatsModal);
            
            // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
            document.getElementById('stats-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideStatsModal();
                }
            });
        }

        // æäº¤ç­”æ¡ˆ
        function submitAnswer() {
            const answerInput = document.getElementById('answer-input');
            const userAnswer = parseInt(answerInput.value);
            
            // éªŒè¯è¾“å…¥
            if (isNaN(userAnswer)) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—', 'error');
                answerInput.focus();
                return;
            }
            
            // è·å–å½“å‰é¢˜ç›®
            const currentQuestion = currentQuestions[currentQuestionIndex];
            const isCorrect = userAnswer === currentQuestion.answer;
            
            // è®°å½•ç­”æ¡ˆ
            userAnswers.push({
                id: currentQuestion.id,
                userAnswer: userAnswer,
                isCorrect: isCorrect,
                timestamp: new Date().toISOString()
            });
            
            // æ›´æ–°ç»Ÿè®¡
            todayStats.total++;
            if (isCorrect) {
                todayStats.correct++;
            } else {
                // æ·»åŠ åˆ°é”™é¢˜é›†
                wrongQuestions.push({
                    id: currentQuestion.id,
                    userAnswer: userAnswer,
                    timestamp: new Date().toISOString()
                });
            }
            
            // ä¿å­˜æ•°æ®
            saveData();
            
            // æ˜¾ç¤ºåé¦ˆ
            const feedbackMessage = document.getElementById('feedback-message');
            feedbackMessage.textContent = isCorrect ? 'âœ… å›ç­”æ­£ç¡®ï¼' : `âŒ å›ç­”é”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯ ${currentQuestion.answer}`;
            feedbackMessage.className = `mt-4 text-lg font-medium ${isCorrect ? 'text-secondary' : 'text-red-500'}`;
            feedbackMessage.classList.remove('hidden');
            
            // æ”¹å˜æäº¤æŒ‰é’®æ ·å¼
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.className = `rounded-lg px-6 py-3 ml-3 btn-hover text-lg font-medium ${isCorrect ? 'btn-correct' : 'btn-incorrect'}`;
            submitBtn.textContent = isCorrect ? 'ä¸‹ä¸€é¢˜' : 'ç»§ç»­';
            
            // ç¦ç”¨è¾“å…¥æ¡†
            answerInput.disabled = true;
            
            // ç‚¹å‡»æŒ‰é’®è¿›å…¥ä¸‹ä¸€é¢˜
            const originalClickHandler = submitBtn.onclick;
            submitBtn.onclick = function() {
                // æ¢å¤æŒ‰é’®æ ·å¼
                submitBtn.className = 'bg-primary hover:bg-indigo-600 text-white rounded-lg px-6 py-3 ml-3 btn-hover text-lg font-medium';
                submitBtn.textContent = 'æäº¤';
                
                // æ¢å¤è¾“å…¥æ¡†
                answerInput.disabled = false;
                
                // æ¢å¤åŸå§‹ç‚¹å‡»äº‹ä»¶
                submitBtn.onclick = originalClickHandler;
                
                // è¿›å…¥ä¸‹ä¸€é¢˜
                nextQuestion();
            };
        }

        // è·³è¿‡å½“å‰é¢˜ç›®
        function skipQuestion() {
            if (currentQuestionIndex < currentQuestions.length) {
                // è®°å½•ä¸ºæœªå›ç­”
                userAnswers.push({
                    id: currentQuestions[currentQuestionIndex].id,
                    userAnswer: null,
                    isCorrect: false,
                    timestamp: new Date().toISOString()
                });
                
                // æ›´æ–°ç»Ÿè®¡
                todayStats.total++;
                
                // æ·»åŠ åˆ°é”™é¢˜é›†
                wrongQuestions.push({
                    id: currentQuestions[currentQuestionIndex].id,
                    userAnswer: null,
                    timestamp: new Date().toISOString()
                });
                
                // ä¿å­˜æ•°æ®
                saveData();
                
                // è¿›å…¥ä¸‹ä¸€é¢˜
                nextQuestion();
                
                showToast('å·²è·³è¿‡æ­¤é¢˜', 'info');
            }
        }

        // è¿›å…¥ä¸‹ä¸€é¢˜
        function nextQuestion() {
            currentQuestionIndex++;
            updateUI();
        }

        // åˆ‡æ¢æ˜¾ç¤º/éšè—é”™é¢˜åˆ—è¡¨
        function toggleWrongQuestions() {
            const wrongQuestionsSection = document.getElementById('wrong-questions-section');
            const showWrongBtn = document.getElementById('show-wrong-btn');
            
            if (wrongQuestionsSection.classList.contains('hidden')) {
                wrongQuestionsSection.classList.remove('hidden');
                showWrongBtn.innerHTML = '<i class="fa fa-times mr-2"></i>éšè—é”™é¢˜';
                showWrongBtn.className = 'bg-red-500 hover:bg-red-600 text-white rounded-lg px-6 py-3 btn-hover';
            } else {
                wrongQuestionsSection.classList.add('hidden');
                showWrongBtn.innerHTML = '<i class="fa fa-exclamation-triangle mr-2"></i>é”™é¢˜å›é¡¾';
                showWrongBtn.className = 'bg-neutral hover:bg-gray-200 text-neutral-dark rounded-lg px-6 py-3 btn-hover';
            }
        }

        // é‡ç½®ä»Šæ—¥ç»ƒä¹ 
        function resetDay() {
            if (confirm('ç¡®å®šè¦é‡ç½®ä»Šæ—¥ç»ƒä¹ å—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰ç­”é¢˜è®°å½•ã€‚')) {
                // é‡ç½®æ•°æ®
                userAnswers = [];
                wrongQuestions = [];
                todayStats = { correct: 0, total: 0 };
                currentQuestionIndex = 0;
                
                // ä¿å­˜æ•°æ®
                saveData();
                
                // æ›´æ–°UI
                updateUI();
                
                // æ˜¾ç¤ºæç¤º
                showToast('ä»Šæ—¥ç»ƒä¹ å·²é‡ç½®', 'success');
            }
        }

        // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveData() {
            localStorage.setItem(`mathPractice_answers_${todayDateStr}`, JSON.stringify(userAnswers));
            localStorage.setItem(`mathPractice_wrong_${todayDateStr}`, JSON.stringify(wrongQuestions));
            localStorage.setItem(`mathPractice_stats_${todayDateStr}`, JSON.stringify(todayStats));
        }

        // æ˜¾ç¤ºç»Ÿè®¡æ¨¡æ€æ¡†
        function showStatsModal() {
            const statsModal = document.getElementById('stats-modal');
            statsModal.classList.remove('hidden');
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateStatsData();
            
            // åˆ›å»ºå›¾è¡¨
            createAccuracyChart();
        }

        // éšè—ç»Ÿè®¡æ¨¡æ€æ¡†
        function hideStatsModal() {
            document.getElementById('stats-modal').classList.add('hidden');
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStatsData() {
            // æ€»ç»ƒä¹ å¤©æ•°
            const uniqueDates = new Set();
            historyStats.forEach(stat => uniqueDates.add(stat.date));
            
            // å¦‚æœä»Šå¤©æœ‰ç»ƒä¹ ï¼Œä¹Ÿè®¡å…¥æ€»å¤©æ•°
            if (todayStats.total > 0) {
                uniqueDates.add(todayDateStr);
            }
            
            document.getElementById('total-days').textContent = uniqueDates.size;
            
            // æœ€ä½³æ­£ç¡®ç‡
            let bestAccuracy = 0;
            historyStats.forEach(stat => {
                if (stat.accuracy > bestAccuracy) {
                    bestAccuracy = stat.accuracy;
                }
            });
            
            // å¦‚æœä»Šå¤©çš„æ­£ç¡®ç‡æ›´é«˜ï¼Œæ›´æ–°æœ€ä½³æ­£ç¡®ç‡
            if (todayStats.total > 0) {
                const todayAccuracy = Math.round((todayStats.correct / todayStats.total) * 100);
                if (todayAccuracy > bestAccuracy) {
                    bestAccuracy = todayAccuracy;
                }
            }
            
            document.getElementById('best-accuracy').textContent = `${bestAccuracy}%`;
            
            // æ€»ç­”é¢˜æ•°
            let totalQuestions = 0;
            historyStats.forEach(stat => {
                totalQuestions += stat.total;
            });
            totalQuestions += todayStats.total;
            
            document.getElementById('total-questions').textContent = totalQuestions;
        }

        // åˆ›å»ºæ­£ç¡®ç‡å›¾è¡¨
        function createAccuracyChart() {
            const ctx = document.getElementById('accuracy-chart').getContext('2d');
            
            // è·å–æœ€è¿‘7å¤©çš„æ•°æ®
            const last7Days = [];
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = formatDate(date);
                
                // æŸ¥æ‰¾å†å²è®°å½•ä¸­æ˜¯å¦æœ‰è¿™ä¸€å¤©çš„æ•°æ®
                const dayData = historyStats.find(stat => stat.date === dateStr);
                
                if (dayData) {
                    last7Days.push({
                        date: formatShortDate(date),
                        accuracy: dayData.accuracy
                    });
                } else if (dateStr === todayDateStr) {
                    // å¦‚æœæ˜¯ä»Šå¤©ï¼Œä½¿ç”¨ä»Šå¤©çš„æ•°æ®
                    const accuracy = todayStats.total > 0 ? Math.round((todayStats.correct / todayStats.total) * 100) : 0;
                    last7Days.push({
                        date: formatShortDate(date),
                        accuracy: accuracy
                    });
                } else {
                    // æ²¡æœ‰æ•°æ®çš„æ—¥æœŸ
                    last7Days.push({
                        date: formatShortDate(date),
                        accuracy: null
                    });
                }
            }
            
            // é”€æ¯æ—§å›¾è¡¨
            if (window.accuracyChart) {
                window.accuracyChart.destroy();
            }
            
            // åˆ›å»ºæ–°å›¾è¡¨
            window.accuracyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days.map(day => day.date),
                    datasets: [{
                        label: 'æ­£ç¡®ç‡ (%)',
                        data: last7Days.map(day => day.accuracy),
                        borderColor: '#4F46E5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        tension: 0.3,
                        fill: true,
                        pointBackgroundColor: function(context) {
                            const value = context.dataset.data[context.dataIndex];
                            return value === null ? '#9CA3AF' : (value >= 80 ? '#10B981' : (value >= 60 ? '#F59E0B' : '#EF4444'));
                        },
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    return value === null ? 'æœªç»ƒä¹ ' : `æ­£ç¡®ç‡: ${value}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // æ ¼å¼åŒ–æ—¥æœŸä¸ºçŸ­æ ¼å¼ (MM/DD)
        function formatShortDate(date) {
            return `${date.getMonth() + 1}/${date.getDate()}`;
        }

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toast-icon');
            const toastMessage = document.getElementById('toast-message');
            
            // è®¾ç½®æ¶ˆæ¯å†…å®¹
            toastMessage.textContent = message;
            
            // è®¾ç½®å›¾æ ‡å’Œé¢œè‰²
            if (type === 'success') {
                toastIcon.className = 'fa fa-check-circle text-secondary mr-3 text-xl';
                toast.className = 'fixed bottom-6 right-6 bg-white rounded-lg shadow-lg px-6 py-3 transform transition-all duration-300 flex items-center';
            } else if (type === 'error') {
                toastIcon.className = 'fa fa-times-circle text-red-500 mr-3 text-xl';
                toast.className = 'fixed bottom-6 right-6 bg-white rounded-lg shadow-lg px-6 py-3 transform transition-all duration-300 flex items-center';
            } else if (type === 'info') {
                toastIcon.className = 'fa fa-info-circle text-primary mr-3 text-xl';
                toast.className = 'fixed bottom-6 right-6 bg-white rounded-lg shadow-lg px-6 py-3 transform transition-all duration-300 flex items-center';
            }
            
            // æ˜¾ç¤ºæç¤º
            toast.classList.remove('translate-y-20', 'opacity-0');
            
            // 3ç§’åéšè—
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
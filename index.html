<html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯¾æ–‡è®¡æ•°å™¨</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- ç»Ÿä¸€çš„ Tailwind é…ç½® -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4A90E2',
                        secondary: '#FF9500',
                        accent: '#50E3C2',
                        background: '#F0F8FF',
                        text: '#333333'
                    },
                    fontFamily: {
                        sans: ['Arial Rounded MT Bold', 'Avenir', 'Helvetica', 'Arial', 'sans-serif'],
                    },
                    animation: {
                        'bounce-slow': 'bounce 2s infinite',
                        'spin-slow': 'spin 3s linear infinite',
                        'wiggle': 'wiggle 1s ease-in-out infinite',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' },
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .text-shadow-lg {
                text-shadow: 0 4px 8px rgba(0,0,0,0.12), 0 2px 4px rgba(0,0,0,0.08);
            }
            .btn-pop {
                transition: all 0.2s ease;
            }
            .btn-pop:hover {
                transform: translateY(-3px);
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            .btn-pop:active {
                transform: translateY(-1px);
            }
            .card {
                transition: all 0.3s ease;
            }
            .card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            .confetti {
                position: absolute;
                width: 10px;
                height: 10px;
                background-color: var(--color);
                border-radius: 50%;
                animation: confetti-fall 3s ease-in-out forwards;
            }
            @keyframes confetti-fall {
                0% {
                    transform: translateY(-100vh) rotate(0deg);
                    opacity: 1;
                }
                100% {
                    transform: translateY(100vh) rotate(720deg);
                    opacity: 0;
                }
            }
        }
    </style>
</head>
<body class="bg-background min-h-screen font-sans text-text">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="bg-primary text-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl md:text-3xl font-bold text-shadow">è¯¾æ–‡è®¡æ•°å™¨ ğŸ“š</h1>
            </div>
        
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="container mx-auto p-4">
        <!-- è®¡æ•°å™¨åŒºåŸŸ -->
        <section class="mb-8 text-center">
            <div class="bg-white rounded-2xl shadow-lg p-6 card">
                <h2 class="text-xl md:text-2xl font-bold mb-4 text-primary">å·²å®Œæˆæœ—è¯»æ¬¡æ•°</h2>
                <div class="flex justify-center items-center bg-gradient-to-r from-primary to-blue-600 rounded-2xl p-8 md:p-12 shadow-xl">
                    <div id="counter" class="text-8xl md:text-9xl lg:text-[10rem] font-bold text-white text-shadow-lg">
                        0
                    </div>
                </div>
                <div id="progressContainer" class="mt-6 bg-gray-200 rounded-full h-6 md:h-8 overflow-hidden">
                    <div id="progressBar" class="bg-gradient-to-r from-primary to-accent h-full w-0 transition-all duration-500"></div>
                </div>
                <p id="progressText" class="mt-2 text-sm md:text-base text-gray-600">è¿›åº¦: 0/10 (ç›®æ ‡)</p>
                <div class="flex justify-center mt-4">
                    <button id="decrementBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg btn-pop disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fa fa-minus mr-2"></i> å‡1
                    </button>
                </div>
            </div>
        </section>

        <!-- æ“ä½œåŒºåŸŸ -->
        <section class="mb-8">
            <div class="bg-white rounded-2xl shadow-lg p-6 card">
                <h2 class="text-xl md:text-2xl font-bold mb-6 text-primary text-center">å®Œæˆæœ—è¯»åç‚¹å‡»ä¸‹é¢æŒ‰é’®</h2>
                <div class="flex justify-center">
                    <button id="readCompleteBtn" class="bg-gradient-to-r from-secondary to-orange-500 text-white text-xl md:text-2xl font-bold px-8 py-4 rounded-full shadow-lg btn-pop flex items-center">
                        <i class="fa fa-microphone mr-3 text-2xl"></i> æˆ‘è¯»å®Œå•¦ï¼
                    </button>
                </div>
            </div>
        </section>

        <!-- æ•°å­¦é¢˜éªŒè¯å¼¹çª— -->
        <div id="mathModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 transform transition-all">
                <h2 class="text-2xl font-bold mb-6 text-primary text-center">å›ç­”é—®é¢˜æ‰èƒ½ç»§ç»­å“¦ï¼</h2>
                <div id="mathProblem" class="text-3xl md:text-4xl font-bold text-center mb-8">
                    3 + 5 = ?
                </div>
                <div class="mb-6">
                    <div class="flex justify-center mb-4">
                        <input type="text" id="answerInput" class="text-4xl font-bold text-center w-24 h-16 border-2 border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary" maxlength="2" readonly>
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <button class="num-key bg-blue-100 hover:bg-blue-200 text-xl font-bold py-4 rounded-lg btn-pop">1</button>
                        <button class="num-key bg-blue-100 hover:bg-blue-200 text-xl font-bold py-4 rounded-lg btn-pop">2</button>
                        <button class="num-key bg-blue-100 hover:bg-blue-200 text-xl font-bold py-4 rounded-lg btn-pop">3</button>
                        <button class="num-key bg-blue-100 hover:bg-blue-200 text-xl font-bold py-4 rounded-lg btn-pop">4</button>
                        <button class="num-key bg-blue-100 hover:bg-blue-200 text-xl font-bold py-4 rounded-lg btn-pop">5</button>
                        <button class="num-key bg-blue-100 hover:bg-blue-200 text-xl font-bold py-4 rounded-lg btn-pop">6</button>
                        <button class="num-key bg-blue-100 hover:bg-blue-200 text-xl font-bold py-4 rounded-lg btn-pop">7</button>
                        <button class="num-key bg-blue-100 hover:bg-blue-200 text-xl font-bold py-4 rounded-lg btn-pop">8</button>
                        <button class="num-key bg-blue-100 hover:bg-blue-200 text-xl font-bold py-4 rounded-lg btn-pop">9</button>
                        <button class="num-key bg-blue-100 hover:bg-blue-200 text-xl font-bold py-4 rounded-lg btn-pop">0</button>
                        <button class="num-key bg-gray-200 hover:bg-gray-300 text-xl font-bold py-4 rounded-lg btn-pop">
                            <i class="fa fa-backspace mr-2"></i> æ¸…é™¤
                        </button>
                        <button class="num-key bg-secondary hover:bg-orange-500 text-white text-xl font-bold py-4 rounded-lg btn-pop">
                            <i class="fa fa-check mr-2"></i> ç¡®è®¤
                        </button>
                    </div>
                </div>
                <div id="mathFeedback" class="text-center text-xl font-bold mb-4 hidden"></div>
                <div class="flex justify-center">
                    <button id="nextProblemBtn" class="bg-secondary hover:bg-orange-500 text-white px-6 py-2 rounded-lg btn-pop hidden">
                        ä¸‹ä¸€é¢˜
                    </button>
                </div>
            </div>
        </div>

        <!-- é¼“åŠ±å¼¹çª— -->
        <div id="encourageModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 transform transition-all">
                <div class="text-center">
                    <div class="text-6xl md:text-7xl font-bold text-secondary mb-6 animate-bounce-slow">ğŸ‰</div>
                    <h2 id="encourageTitle" class="text-2xl md:text-3xl font-bold mb-4 text-secondary">å¤ªæ£’äº†ï¼</h2>
                    <p id="encourageMessage" class="text-lg md:text-xl mb-6">ä½ å·²ç»å®Œæˆäº† <span id="encourageCount" class="font-bold text-primary">1</span> æ¬¡æœ—è¯»ï¼</p>
                    <div id="achievementUnlocked" class="bg-yellow-100 border-2 border-yellow-300 rounded-lg p-4 mb-6 hidden">
                        <p class="text-yellow-800 font-bold">ğŸ† æˆå°±è§£é”ï¼</p>
                        <p id="achievementMessage" class="text-yellow-700">è¿ç»­æœ—è¯» 5 æ¬¡ï¼ŒçœŸæ£’ï¼</p>
                    </div>
                    <button id="continueBtn" class="bg-gradient-to-r from-primary to-blue-600 text-white text-xl font-bold px-8 py-3 rounded-full shadow-lg btn-pop">
                        ç»§ç»­åŠ æ²¹ï¼
                    </button>
                </div>
            </div>
        </div>

        <!-- è®¾ç½®å¼¹çª— -->
        <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 transform transition-all">
                <h2 class="text-2xl font-bold mb-6 text-primary text-center">è®¾ç½®</h2>
                <div class="mb-6">
                    <label for="targetInput" class="block text-lg font-medium mb-2">æ¯æ—¥ç›®æ ‡æ¬¡æ•°</label>
                    <input type="number" id="targetInput" min="1" max="100" class="w-full p-3 border-2 border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary">
                </div>
                <div class="mb-6">
                    <label class="block text-lg font-medium mb-2">å£°éŸ³æ•ˆæœ</label>
                    <div class="flex items-center">
                        <input type="checkbox" id="soundToggle" class="w-5 h-5 text-primary focus:ring-primary">
                        <label for="soundToggle" class="ml-2 text-lg">å¯ç”¨é¼“åŠ±éŸ³æ•ˆ</label>
                    </div>
                </div>
                <div class="mb-6">
                    <label class="block text-lg font-medium mb-2">éš¾åº¦è®¾ç½®</label>
                    <select id="difficultySelect" class="w-full p-3 border-2 border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary">
                        <option value="easy">åˆçº§ (10ä»¥å†…åŠ å‡æ³•)</option>
                        <option value="medium" selected="">ä¸­çº§ (100ä»¥å†…åŠ å‡æ³•)</option>
                        <option value="hard">é«˜çº§ (100ä»¥å†…åŠ å‡ä¹˜é™¤æ³•)</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-4">
                    <button id="resetCounterBtn" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg btn-pop">
                        é‡ç½®è®¡æ•°å™¨
                    </button>
                    <button id="saveSettingsBtn" class="bg-primary hover:bg-blue-600 text-white px-6 py-2 rounded-lg btn-pop">
                        ä¿å­˜è®¾ç½®
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer class="bg-primary text-white p-4 mt-8">
        <div class="container mx-auto text-center">
            <p>è¯¾æ–‡è®¡æ•°å™¨ Â© 2025</p>
            <p class="text-sm mt-2">è®©æœ—è¯»å˜å¾—æ›´æœ‰è¶£ï¼</p>
            <button id="settingsBtn" class="mt-2 text-xs text-gray-200 hover:text-white focus:outline-none">
                <i class="fa fa-cog"></i> è®¾ç½®
            </button>
        </div>
    </footer>

    <!-- éŸ³æ•ˆå…ƒç´  -->
    <audio id="correctSound" src="https://orangefreesounds.com/wp-content/uploads/2025/02/Kids-cheering-sound-effect.mp3" preload="auto"></audio>
    <audio id="encourageSound" src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" preload="auto"></audio>
    <audio id="achievementSound" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" preload="auto"></audio>

    <script>
        // å…¨å±€å˜é‡
        let count = 0;
        let target = 10;
        let soundEnabled = true;
        let difficulty = 'medium';
        let lastResetDate = '';
        let currentMathProblem = {
            num1: 0,
            num2: 0,
            operator: '+',
            answer: 0
        };

        // DOM å…ƒç´ 
        const counterElement = document.getElementById('counter');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const readCompleteBtn = document.getElementById('readCompleteBtn');
        const mathModal = document.getElementById('mathModal');
        const mathProblem = document.getElementById('mathProblem');
        const mathFeedback = document.getElementById('mathFeedback');
        const nextProblemBtn = document.getElementById('nextProblemBtn');
        const encourageModal = document.getElementById('encourageModal');
        const encourageTitle = document.getElementById('encourageTitle');
        const encourageMessage = document.getElementById('encourageMessage');
        const encourageCount = document.getElementById('encourageCount');
        const achievementUnlocked = document.getElementById('achievementUnlocked');
        const achievementMessage = document.getElementById('achievementMessage');
        const continueBtn = document.getElementById('continueBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const targetInput = document.getElementById('targetInput');
        const soundToggle = document.getElementById('soundToggle');
        const difficultySelect = document.getElementById('difficultySelect');
        const resetCounterBtn = document.getElementById('resetCounterBtn');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        const answerInput = document.getElementById('answerInput');
        const numKeys = document.querySelectorAll('.num-key');
        const decrementBtn = document.getElementById('decrementBtn');
        
        // éŸ³æ•ˆå…ƒç´ 
        const correctSound = document.getElementById('correctSound');
        const encourageSound = document.getElementById('encourageSound');
        const achievementSound = document.getElementById('achievementSound');

        // åˆå§‹åŒ–
        function init() {
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
            loadData();
            
            // æ›´æ–°UI
            updateCounter();
            updateProgress();
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            readCompleteBtn.addEventListener('click', handleReadComplete);
            nextProblemBtn.addEventListener('click', generateMathProblem);
            continueBtn.addEventListener('click', closeEncourageModal);
            settingsBtn.addEventListener('click', openSettings);
            saveSettingsBtn.addEventListener('click', saveSettings);
            resetCounterBtn.addEventListener('click', resetCounter);
            
            // è®¾ç½®æ•°å­—é”®ç›˜äº‹ä»¶
            numKeys.forEach(key => {
                key.addEventListener('click', () => {
                    const keyText = key.textContent.trim();
                    
                    if (keyText === 'æ¸…é™¤' || keyText.includes('backspace')) {
                        // æ¸…é™¤è¾“å…¥
                        answerInput.value = '';
                    } else if (keyText === 'ç¡®è®¤' || keyText.includes('check')) {
                        // ç¡®è®¤ç­”æ¡ˆ
                        if (answerInput.value) {
                            checkAnswer(parseInt(answerInput.value));
                        }
                    } else if (!isNaN(parseInt(keyText))) {
                        // æ•°å­—è¾“å…¥ï¼Œæœ€å¤šè¾“å…¥2ä½
                        if (answerInput.value.length < 2) {
                            answerInput.value += keyText;
                        }
                    }
                });
            });
            
            // è®¾ç½®å‡1æŒ‰é’®äº‹ä»¶
            decrementBtn.addEventListener('click', decrementCounter);
            
            // ç”Ÿæˆç¬¬ä¸€é¢˜
            generateMathProblem();
            
            // æ›´æ–°å‡1æŒ‰é’®çŠ¶æ€
            updateDecrementButtonState();
        }

        // åŠ è½½æœ¬åœ°å­˜å‚¨æ•°æ®
        function loadData() {
            const savedCount = localStorage.getItem('readerCount');
            const savedTarget = localStorage.getItem('readerTarget');
            const savedSound = localStorage.getItem('readerSound');
            const savedDifficulty = localStorage.getItem('readerDifficulty');
            lastResetDate = localStorage.getItem('readerLastResetDate') || '';
            
            if (savedCount) count = parseInt(savedCount);
            if (savedTarget) target = parseInt(savedTarget);
            if (savedSound !== null) soundEnabled = savedSound === 'true';
            if (savedDifficulty) difficulty = savedDifficulty;
            
            // æ£€æŸ¥æ˜¯å¦éœ€è¦æ¯æ—¥æ¸…é›¶
            checkDailyReset();
        }
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦æ¯æ—¥æ¸…é›¶
        function checkDailyReset() {
            const today = new Date().toISOString().split('T')[0]; // è·å–å½“å‰æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
            
            if (lastResetDate !== today) {
                // å¦‚æœä¸æ˜¯ä»Šå¤©é‡ç½®çš„ï¼Œåˆ™é‡ç½®è®¡æ•°å™¨
                count = 0;
                lastResetDate = today;
                saveData();
            }
        }

        // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveData() {
            localStorage.setItem('readerCount', count);
            localStorage.setItem('readerTarget', target);
            localStorage.setItem('readerSound', soundEnabled);
            localStorage.setItem('readerDifficulty', difficulty);
            localStorage.setItem('readerLastResetDate', lastResetDate);
        }

        // æ›´æ–°è®¡æ•°å™¨
        function updateCounter() {
            counterElement.textContent = count;
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            counterElement.classList.add('scale-125', 'text-secondary');
            setTimeout(() => {
                counterElement.classList.remove('scale-125', 'text-secondary');
            }, 300);
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress() {
            const percentage = Math.min((count / target) * 100, 100);
            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `è¿›åº¦: ${count}/${target} (ç›®æ ‡)`;
            
            // æ›´æ–°å‡1æŒ‰é’®çŠ¶æ€
            updateDecrementButtonState();
        }
        
        // æ›´æ–°å‡1æŒ‰é’®çŠ¶æ€
        function updateDecrementButtonState() {
            decrementBtn.disabled = count <= 0;
        }
        
        // å‡å°‘è®¡æ•°
        function decrementCounter() {
            if (count > 0) {
                count--;
                saveData();
                updateCounter();
                updateProgress();
            }
        }

        // å¤„ç†æœ—è¯»å®ŒæˆæŒ‰é’®ç‚¹å‡»
        function handleReadComplete() {
            mathModal.classList.remove('hidden');
            generateMathProblem();
        }

        // ç”Ÿæˆéšæœºæ•°å­¦é¢˜
        function generateMathProblem() {
            let num1, num2, operator, answer;
            
            // æ ¹æ®éš¾åº¦è®¾ç½®ç¡®å®šæ•°å­—èŒƒå›´å’Œè¿ç®—ç¬¦
            if (difficulty === 'easy') {
                // åˆçº§ï¼š10ä»¥å†…åŠ å‡æ³•
                const maxNum = 10;
                operator = Math.random() > 0.5 ? '+' : '-';
                
                if (operator === '+') {
                    // åŠ æ³•ç¡®ä¿ç­”æ¡ˆåœ¨1-10ä¹‹é—´
                    num1 = Math.floor(Math.random() * maxNum) + 1; // 1-10
                    num2 = Math.floor(Math.random() * (maxNum - num1 + 1)) + 1; // 1-(10-num1)
                    answer = num1 + num2;
                } else {
                    // å‡æ³•ç¡®ä¿ç»“æœåœ¨0-10ä¹‹é—´
                    num1 = Math.floor(Math.random() * maxNum) + 1; // 1-10
                    num2 = Math.floor(Math.random() * (num1 + 1)); // 0-num1
                    answer = num1 - num2;
                }
            } else if (difficulty === 'medium') {
                // ä¸­çº§ï¼š100ä»¥å†…åŠ å‡æ³•
                const maxNum = 100;
                operator = Math.random() > 0.5 ? '+' : '-';
                
                if (operator === '+') {
                    // åŠ æ³•ç¡®ä¿ç­”æ¡ˆåœ¨1-100ä¹‹é—´
                    num1 = Math.floor(Math.random() * maxNum) + 1; // 1-100
                    num2 = Math.floor(Math.random() * (maxNum - num1 + 1)) + 1; // 1-(100-num1)
                    answer = num1 + num2;
                } else {
                    // å‡æ³•ç¡®ä¿ç»“æœåœ¨0-100ä¹‹é—´
                    num1 = Math.floor(Math.random() * maxNum) + 1; // 1-100
                    num2 = Math.floor(Math.random() * (num1 + 1)); // 0-num1
                    answer = num1 - num2;
                }
            } else {
                // é«˜çº§ï¼š100ä»¥å†…åŠ å‡ä¹˜é™¤æ³•
                const maxNum = 100;
                const operators = ['+', '-', 'Ã—', 'Ã·'];
                operator = operators[Math.floor(Math.random() * operators.length)];
                
                if (operator === '+') {
                    // åŠ æ³•ç¡®ä¿ç­”æ¡ˆåœ¨1-100ä¹‹é—´
                    num1 = Math.floor(Math.random() * maxNum) + 1; // 1-100
                    num2 = Math.floor(Math.random() * (maxNum - num1 + 1)) + 1; // 1-(100-num1)
                    answer = num1 + num2;
                } else if (operator === '-') {
                    // å‡æ³•ç¡®ä¿ç»“æœåœ¨0-100ä¹‹é—´
                    num1 = Math.floor(Math.random() * maxNum) + 1; // 1-100
                    num2 = Math.floor(Math.random() * (num1 + 1)); // 0-num1
                    answer = num1 - num2;
                } else if (operator === 'Ã—') {
                    // ä¹˜æ³•ç¡®ä¿ç­”æ¡ˆåœ¨1-100ä¹‹é—´
                    const maxFactor = Math.floor(Math.sqrt(maxNum));
                    num1 = Math.floor(Math.random() * maxFactor) + 1; // 1-10
                    num2 = Math.floor(Math.random() * (maxNum / num1)) + 1; // 1-(100/num1)
                    answer = num1 * num2;
                } else {
                    // é™¤æ³•ç¡®ä¿ç»“æœä¸ºæ•´æ•°ä¸”åœ¨1-100ä¹‹é—´
                    const maxDivisor = Math.floor(Math.sqrt(maxNum));
                    num2 = Math.floor(Math.random() * maxDivisor) + 1; // 1-10
                    num1 = num2 * (Math.floor(Math.random() * (maxNum / num2)) + 1); // 1-100ä¸”èƒ½è¢«num2æ•´é™¤
                    answer = num1 / num2;
                }
            }
            
            // æ›´æ–°å½“å‰é¢˜ç›®
            currentMathProblem = { num1, num2, operator, answer };
            
            // æ›´æ–°UI
            mathProblem.textContent = `${num1} ${operator} ${num2} = ?`;
            mathFeedback.classList.add('hidden');
            nextProblemBtn.classList.add('hidden');
            
            // é‡ç½®æ•°å­—é”®ç›˜
            numKeys.forEach(key => {
                key.disabled = false;
                key.classList.remove('opacity-50');
                key.classList.remove('bg-green-200', 'bg-red-200');
                key.classList.add('bg-blue-100');
            });
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            answerInput.value = '';
        }

        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer(userAnswer) {
            const isCorrect = userAnswer === currentMathProblem.answer;
            
            // ç¦ç”¨æ‰€æœ‰æ•°å­—é”®
            numKeys.forEach(key => {
                key.disabled = true;
                if (!key.textContent.includes('æ¸…é™¤')) {
                    key.classList.add('opacity-50');
                }
            });
            
            // æ˜¾ç¤ºåé¦ˆ
            mathFeedback.textContent = isCorrect ? 'ğŸ‰ ç­”å¯¹äº†ï¼çœŸæ£’ï¼' : `âŒ ä¸å¯¹å“¦ï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯ ${currentMathProblem.answer}`;
            mathFeedback.className = `text-center text-xl font-bold mb-4 ${isCorrect ? 'text-green-500' : 'text-red-500'}`;
            mathFeedback.classList.remove('hidden');
            
            // æ’­æ”¾éŸ³æ•ˆ
            if (soundEnabled && isCorrect) {
                correctSound.play();
            }
            
            if (isCorrect) {
                // ç­”å¯¹äº†ï¼Œæ˜¾ç¤ºä¸‹ä¸€é¢˜æŒ‰é’®
                nextProblemBtn.classList.remove('hidden');
            } else {
                // ç­”é”™äº†ï¼Œ3ç§’åè‡ªåŠ¨ç”Ÿæˆæ–°é¢˜
                setTimeout(generateMathProblem, 3000);
            }
        }

        // å…³é—­é¼“åŠ±å¼¹çª—
        function closeEncourageModal() {
            encourageModal.classList.add('hidden');
            
            // æ£€æŸ¥æ˜¯å¦è¾¾æˆç›®æ ‡
            if (count >= target) {
                showConfetti();
            }
        }

        // æ˜¾ç¤ºé¼“åŠ±å¼¹çª—
        function showEncourageModal() {
            encourageCount.textContent = count;
            
            // æ ¹æ®è®¡æ•°å’Œç›®æ ‡æ˜¾ç¤ºä¸åŒçš„é¼“åŠ±è¯­
            let encouragementTitle, encouragementMessage;
            
            if (count === target) {
                encouragementTitle = 'ç›®æ ‡è¾¾æˆï¼';
                encouragementMessage = `æ­å–œä½ å®Œæˆäº† ${target} æ¬¡æœ—è¯»ç›®æ ‡ï¼`;
            } else if (count === Math.floor(target * 0.5)) {
                encouragementTitle = 'å¤ªæ£’äº†ï¼';
                encouragementMessage = `ä½ å·²ç»å®Œæˆäº†ç›®æ ‡çš„ä¸€åŠï¼ˆ${count}/${target}ï¼‰ï¼Œç»§ç»­åŠ æ²¹ï¼`;
            } else if (count === Math.floor(target * 0.8)) {
                encouragementTitle = 'å¿«å®Œæˆäº†ï¼';
                encouragementMessage = `ä½ å·²ç»å®Œæˆäº† ${count}/${target} æ¬¡æœ—è¯»ï¼Œç¦»ç›®æ ‡ä¸è¿œäº†ï¼`;
            } else if (count % 5 === 0) {
                encouragementTitle = 'çœŸä¸é”™ï¼';
                encouragementMessage = `ä½ å·²ç»è¿ç»­æœ—è¯»äº† ${count} æ¬¡ï¼Œç»§ç»­ä¿æŒï¼`;
            } else {
                // éšæœºé€‰æ‹©ä¸€ä¸ªé¼“åŠ±è¯­
                const encouragements = [
                    'å¤ªæ£’äº†ï¼',
                    'çœŸå‰å®³ï¼',
                    'ç»§ç»­åŠ æ²¹ï¼',
                    'ä½ çœŸåŠªåŠ›ï¼',
                    'å¤ªäº†ä¸èµ·äº†ï¼',
                    'ç»§ç»­ä¿æŒï¼',
                    'ä½ æ˜¯æœ€æ£’çš„ï¼',
                    'çœŸä¸é”™ï¼'
                ];
                
                const messages = [
                    `ä½ å·²ç»å®Œæˆäº† ${count} æ¬¡æœ—è¯»ï¼`,
                    'ç»§ç»­ä¿æŒï¼Œä½ æ­£åœ¨è¿›æ­¥ï¼',
                    'é˜…è¯»æ˜¯ä¸ªå¥½ä¹ æƒ¯ï¼ŒåšæŒä¸‹å»ï¼',
                    `ä½ å·²ç»æœ—è¯»äº† ${count} æ¬¡ï¼ŒçœŸæ£’ï¼`,
                    'æ¯ä¸€æ¬¡æœ—è¯»éƒ½è®©ä½ å˜å¾—æ›´æ£’ï¼',
                    'ä½ çš„å£°éŸ³çœŸå¥½å¬ï¼Œç»§ç»­æœ—è¯»å§ï¼',
                    `ç¦»ç›®æ ‡ ${target} æ¬¡è¿˜æœ‰ ${target - count} æ¬¡ï¼ŒåŠ æ²¹ï¼`
                ];
                
                const titleIndex = Math.floor(Math.random() * encouragements.length);
                const messageIndex = Math.floor(Math.random() * messages.length);
                
                encouragementTitle = encouragements[titleIndex];
                encouragementMessage = messages[messageIndex];
            }
            
            encourageTitle.textContent = encouragementTitle;
            encourageMessage.textContent = encouragementMessage;
            
            // æ£€æŸ¥æ˜¯å¦è§£é”æˆå°±
            checkAchievements();
            
            // æ˜¾ç¤ºå¼¹çª—
            encourageModal.classList.remove('hidden');
            
            // æ’­æ”¾éŸ³æ•ˆ
            if (soundEnabled) {
                encourageSound.play();
            }
        }

        // æ£€æŸ¥æˆå°±
        function checkAchievements() {
            achievementUnlocked.classList.add('hidden');
            
            // è¿ç»­æœ—è¯»5æ¬¡
            if (count === 5) {
                achievementUnlocked.classList.remove('hidden');
                achievementMessage.textContent = 'è¿ç»­æœ—è¯» 5 æ¬¡ï¼ŒçœŸæ£’ï¼';
                if (soundEnabled) {
                    achievementSound.play();
                }
            }
            
            // å®Œæˆç›®æ ‡
            if (count === target) {
                achievementUnlocked.classList.remove('hidden');
                achievementMessage.textContent = `æ­å–œä½ å®Œæˆäº† ${target} æ¬¡æœ—è¯»ç›®æ ‡ï¼`;
                if (soundEnabled) {
                    achievementSound.play();
                }
            }
            
            // è¶…è¿‡ç›®æ ‡
            if (count > target && count % 5 === 0) {
                achievementUnlocked.classList.remove('hidden');
                achievementMessage.textContent = `å¤ªæ£’äº†ï¼ä½ å·²ç»è¶…è¿‡ç›®æ ‡ ${count - target} æ¬¡äº†ï¼`;
                if (soundEnabled) {
                    achievementSound.play();
                }
            }
        }

        // æ‰“å¼€è®¾ç½®å¼¹çª—
        function openSettings() {
            targetInput.value = target;
            soundToggle.checked = soundEnabled;
            difficultySelect.value = difficulty;
            settingsModal.classList.remove('hidden');
        }

        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            target = parseInt(targetInput.value) || 10;
            soundEnabled = soundToggle.checked;
            difficulty = difficultySelect.value;
            
            // æ›´æ–°è¿›åº¦
            updateProgress();
            
            // ä¿å­˜æ•°æ®
            saveData();
            
            // å…³é—­å¼¹çª—
            settingsModal.classList.add('hidden');
        }

        // é‡ç½®è®¡æ•°å™¨
        function resetCounter() {
            if (confirm('ç¡®å®šè¦é‡ç½®è®¡æ•°å™¨å—ï¼Ÿ')) {
                count = 0;
                lastResetDate = new Date().toISOString().split('T')[0];
                updateCounter();
                updateProgress();
                saveData();
            }
        }

        // åˆ‡æ¢è¯¾æ–‡ï¼ˆä»…æ”¯æŒè‡ªå®šä¹‰ï¼‰
        function changeText() {
            // å§‹ç»ˆæ˜¾ç¤ºè‡ªå®šä¹‰è¯¾æ–‡åŒºåŸŸ
            customTextContainer.classList.remove('hidden');
        }

        // ä¿å­˜è‡ªå®šä¹‰è¯¾æ–‡
        function saveCustomTextHandler() {
            const text = customText.value.trim();
            if (text) {
                textDisplay.innerHTML = text.split('\n').map(line => `<p>${line}</p>`).join('');
                // ä¿å­˜åä¿æŒåŒºåŸŸå±•å¼€
                if (textContent.classList.contains('hidden')) {
                    toggleTextArea();
                }
            }
        }
        
        // å±•å¼€/æŠ˜å è¯¾æ–‡åŒºåŸŸ
        function toggleTextArea() {
            const isHidden = textContent.classList.contains('hidden');
            const icon = toggleTextAreaBtn.querySelector('i');
            
            if (isHidden) {
                textContent.classList.remove('hidden');
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            } else {
                textContent.classList.add('hidden');
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        }

        // æ˜¾ç¤ºå½©è‰²çº¸å±‘æ•ˆæœ
        function showConfetti() {
            const colors = ['#4A90E2', '#FF9500', '#50E3C2', '#FF6B6B', '#C44569', '#F7DC6F', '#BB8FCE'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.animationDelay = `${Math.random() * 3}s`;
                confetti.style.setProperty('--color', colors[Math.floor(Math.random() * colors.length)]);
                document.body.appendChild(confetti);
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    confetti.remove();
                }, 3000);
            }
        }

        // äº‹ä»¶ç›‘å¬å™¨ - ä¸‹ä¸€é¢˜æŒ‰é’®
        nextProblemBtn.addEventListener('click', () => {
            // å¢åŠ è®¡æ•°
            count++;
            
            // æ›´æ–°UI
            updateCounter();
            updateProgress();
            
            // ä¿å­˜æ•°æ®
            saveData();
            
            // å…³é—­æ•°å­¦é¢˜å¼¹çª—
            mathModal.classList.add('hidden');
            
            // æ˜¾ç¤ºé¼“åŠ±å¼¹çª—
            showEncourageModal();
        });

        // åˆå§‹åŒ–åº”ç”¨
        window.addEventListener('DOMContentLoaded', init);
    </script>


</body></html>